#!/bin/sh
# since 3.9 intel_pstate supports two governors, powersave and performance
# per https://wiki.archlinux.org/index.php/CPU_frequency_scaling

# relies on intel_pstate
[ -d /sys/devices/system/cpu/intel_pstate ] || exit $NA

NO_TURBO_BATTERY=true
GOVERNOR="/sys/devices/system/cpu/cpu*/cpufreq/scaling_governor"

case $1 in
    true) 
      echo powersave | tee $GOVERNOR
      echo 1 > /sys/devices/system/cpu/intel_pstate/no_turbo
      ;;
    false)
      echo performance | tee $GOVERNOR
      echo 0 > /sys/devices/system/cpu/intel_pstate/no_turbo
      ;;
    *) exit $NA;;
esac

exit 0
